import{a as p,A as h,c as v,h as b}from"./config.BSXzPuxh.js";document.addEventListener("DOMContentLoaded",async()=>{const y=document.getElementById("loginForm"),g=await p();g.available||console.warn("Servidor no disponible:",g.message);function r(a,o){return a==="admin"&&o==="admin123"?(localStorage.setItem("isLoggedIn","true"),localStorage.setItem("nombreUsuario",a),e("Autenticación local exitosa. Redirigiendo...","success"),setTimeout(()=>{window.location.href="/admin"},1e3),!0):(e("Credenciales locales incorrectas","error"),d(!1),!1)}const c=document.getElementById("loginButton"),f=document.getElementById("loadingSpinner"),n=document.getElementById("statusMessage");function e(a,o="info"){switch(n.textContent=a,n.className="mt-2 text-sm text-center",o){case"error":n.classList.add("text-red-600");break;case"success":n.classList.add("text-green-600");break;case"warning":n.classList.add("text-yellow-600");break;default:n.classList.add("text-gray-600")}n.classList.remove("hidden")}function d(a){a?(f.classList.remove("hidden"),c.disabled=!0,c.classList.add("opacity-75")):(f.classList.add("hidden"),c.disabled=!1,c.classList.remove("opacity-75"))}y.addEventListener("submit",async a=>{a.preventDefault();const o=document.getElementById("usuario").value,s=document.getElementById("password").value;if(!o||!s){e("Por favor, ingrese usuario y contraseña","error");return}d(!0),e("Verificando credenciales...","info");const l=await p();if(!l.available&&l.type==="cors"&&(e(`Error de CORS detectado: ${l.message}. Usando autenticación local como respaldo.`,"warning"),r(o,s))){e("Autenticación local exitosa. Redirigiendo...","success");return}try{const t=new AbortController,i=setTimeout(()=>t.abort(),1e4);console.log("Intentando conectar a:",`${h}/token`),e("Conectando con el servidor...","info");const w={method:"POST",...v,body:`username=${encodeURIComponent(o)}&password=${encodeURIComponent(s)}`,signal:t.signal};w.headers={...v.headers,Origin:window.location.origin};const u=await fetch(`${h}/token`,w);if(clearTimeout(i),!u.ok){const I=(await u.json().catch(()=>({}))).detail||"Error de autenticación";throw new Error(I)}const m=await u.json();console.log("Respuesta de autenticación:",JSON.stringify(m)),localStorage.setItem("isLoggedIn","true"),localStorage.setItem("nombreUsuario",o),localStorage.setItem("token",m.access_token),console.log("Token guardado:",m.access_token?"Token presente":"Token ausente"),console.log("Autenticación exitosa"),e("Autenticación exitosa. Redirigiendo...","success"),setTimeout(()=>{window.location.href="/admin"},1e3)}catch(t){typeof timeoutId<"u"&&clearTimeout(timeoutId),d(!1),console.error("Error de autenticación:",t);const i=b(t);switch(i.type){case"timeout":e("La conexión al servidor ha tardado demasiado tiempo. Usando autenticación local como respaldo.","warning"),r(o,s);break;case"connection":e("No se pudo conectar con el servidor. Verificando autenticación local...","warning"),r(o,s);break;case"cors":e("Error de CORS detectado. Usando autenticación local como respaldo.","warning"),r(o,s);break;default:t.message&&(t.message.includes("credenciales")||t.message.includes("credentials"))?e("Las credenciales son incorrectas. Por favor verifique su usuario y contraseña.","error"):r(o,s)?e("Usando autenticación local como respaldo debido a: "+i.message,"warning"):e("Error de autenticación: "+i.message,"error")}}})});
